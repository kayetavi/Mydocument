<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Damage Mechanism Highlight</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
    }
    .container {
      display: flex;
      width: 100%;
    }
    .sidebar {
      width: 220px;
      background: #f4f4f4;
      padding: 10px;
      border-right: 1px solid #ccc;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar li {
      padding: 5px;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s ease;
    }
    .sidebar li:hover {
      background: #ddd;
    }
    .drawing {
      flex: 1;
      padding: 10px;
      overflow: auto;
      background: #fff;
      position: relative;
    }
    #svgObject {
      width: 100%;
      height: 95vh;
      border: 1px solid #ccc;
    }

    /* ✅ Blinking + Glow */
    .blink-glow {
      animation: blink 1s infinite alternate;
      filter: drop-shadow(0 0 5px yellow) drop-shadow(0 0 10px red);
    }
    @keyframes blink {
      from {
        fill: red;
        stroke: yellow;
        stroke-width: 3px;
      }
      to {
        fill: yellow;
        stroke: red;
        stroke-width: 4px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <h3>Damage Mechanisms</h3>
    <ul id="dm-list">
      <li data-dm="7">7 - Naphthenic Acid Corrosion</li>
      <li data-dm="8">8 - Ammonium Bisulfide Corrosion</li>
      <li data-dm="9">9 - Ammonium Chloride Corrosion</li>
      <li data-dm="20">20 - Erosion / Corrosion</li>
      <li data-dm="23">23 - Amine SCC</li>
      <li data-dm="46">46 - Stress Relaxation Cracking</li>
    </ul>
  </div>

  <div class="drawing">
    <object id="svgObject" data="HCU-Model-Final.svg" type="image/svg+xml"></object>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const dmListItems = document.querySelectorAll("#dm-list li");
  const svgObject = document.getElementById("svgObject");

  svgObject.addEventListener("load", () => {
    const svgDoc = svgObject.contentDocument;

    dmListItems.forEach(item => {
      item.addEventListener("click", () => {
        const selectedDM = item.getAttribute("data-dm").trim();
        console.clear();
        console.log("Selected DM:", selectedDM);

        // ✅ Remove previous effects
        svgDoc.querySelectorAll("text, tspan").forEach(txt => {
          txt.classList.remove("blink-glow");
          txt.style.transform = "";
        });

        let count = 0;
        let firstElement = null;

        // ✅ Highlight + Glow
        svgDoc.querySelectorAll("text, tspan").forEach(txt => {
          const cleanText = txt.textContent.replace(/\s+/g, '').trim();
          if (cleanText === selectedDM) {
            txt.classList.add("blink-glow");
            if (!firstElement) firstElement = txt;
            count++;
          }
        });

        console.log("Matched Elements:", count);

        // ✅ Auto-Zoom (scroll into view)
        if (firstElement) {
          const bbox = firstElement.getBBox();
          const svgRoot = svgDoc.querySelector("svg");

          const zoomLevel = 2; // 2x zoom
          const centerX = bbox.x + bbox.width / 2;
          const centerY = bbox.y + bbox.height / 2;

          svgRoot.setAttribute("viewBox", 
            `${centerX - (svgRoot.clientWidth / (2 * zoomLevel))} 
             ${centerY - (svgRoot.clientHeight / (2 * zoomLevel))} 
             ${svgRoot.clientWidth / zoomLevel} 
             ${svgRoot.clientHeight / zoomLevel}`);
        }
      });
    });
  });
});
</script>
</body>
</html>
