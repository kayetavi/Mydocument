<body>
  <!-- ... heading, buttons ... -->

  <input type="file" id="fileInput" />
  <button onclick="uploadFile()">Upload</button>

  <h3 id="fileLink"></h3>
  <iframe id="filePreview"></iframe>

  <!-- ðŸ‘‡ SCRIPT block yahan hai -->
  <script type="module">
    import { app } from './firebase.js';
    import {
      getAuth, onAuthStateChanged, signOut
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import {
      getStorage, ref, uploadBytesResumable, getDownloadURL
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js';

    const auth = getAuth(app);
    const storage = getStorage(app);

    // âœ… Replace only this function below:
    window.uploadFile = function () {
      const file = document.getElementById("fileInput").files[0];
      if (!file) {
        alert("Please select a file.");
        return;
      }

      const userEmail = auth.currentUser.email.replace(/\./g, '_');
      const path = `documents/${userEmail}/${file.name}`;
      const storageRef = ref(storage, path);
      const uploadTask = uploadBytesResumable(storageRef, file);

      console.log("Uploading:", path);

      uploadTask.on('state_changed',
        (snapshot) => {
          const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          console.log('Upload is ' + progress.toFixed(2) + '% done');
        },
        (error) => {
          alert("Upload failed: " + error.message);
          console.error("Upload error:", error);
        },
        () => {
          getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
            console.log("Download URL:", downloadURL);

            document.getElementById("fileLink").innerHTML =
              `<strong>âœ… Uploaded:</strong> <a href="${downloadURL}" target="_blank">${file.name}</a>`;

            const ext = file.name.split('.').pop().toLowerCase();
            if (ext === "pdf") {
              document.getElementById("filePreview").src = downloadURL;
            } else {
              document.getElementById("filePreview").src = "";
            }
          }).catch(error => {
            console.error("Error getting download URL:", error);
            alert("Download URL not available.");
          });
        }
      );
    };

    // Other code...
    onAuthStateChanged(auth, user => { ... });
    window.logout = function () { ... };
  </script>
</body>
