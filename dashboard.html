<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Damage Mechanism Highlight + Manual Zoom</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
    }
    .container {
      display: flex;
      width: 100%;
    }
    .sidebar {
      width: 220px;
      background: #f4f4f4;
      padding: 10px;
      border-right: 1px solid #ccc;
    }
    .sidebar h3 {
      margin-top: 0;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar li {
      padding: 5px;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s ease;
    }
    .sidebar li:hover {
      background: #ddd;
    }
    .drawing {
      flex: 1;
      padding: 0;
      overflow: hidden;
      background: #fff;
      position: relative;
    }
    #svgContainer {
      width: 100%;
      height: 95vh;
      border: 1px solid #ccc;
      cursor: grab;
    }

    /* ‚úÖ Show Details Blink */
    #showDetailsMsg {
      position: absolute;
      top: 10px;
      left: 240px;
      background: yellow;
      color: red;
      font-weight: bold;
      padding: 5px 10px;
      border: 1px solid red;
      display: none;
      animation: blink 1s infinite;
      cursor: pointer;
      z-index: 10;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    /* ‚úÖ Modal */
    #popupModal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      margin: 10% auto;
      width: 50%;
      border-radius: 8px;
      position: relative;
    }

    .modal-content h2 {
      margin-top: 0;
    }

    .closeBtn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="sidebar">
    <h3>Damage Mechanisms</h3>
    <ul id="dm-list">
      <li data-dm="1">1 - Sulfidation</li>
      <li data-dm="2">2 - Wet H2S Damage (Blistering/HIC/SOHIC/SSC)</li>
      <li data-dm="3">3 - Creep and Stress Rupture</li>
      <li data-dm="4">4 - High-temperature H2/H2S Corrosion</li>
      <li data-dm="5">5 - Polythionic Acid SCC</li>
      <li data-dm="6">6 - Naphthenic Acid Corrosion</li>
      <li data-dm="7">7 - Ammonium Bisulfide Corrosion</li>
      <li data-dm="8">8 - Ammonium Chloride Corrosion</li>
      <li data-dm="9">9 - HCL Corrosion</li>
      <li data-dm="10">10 - High-temperature Hydrogen Attack</li>
      <li data-dm="16">16 - Temper Embrittlement</li>
      <li data-dm="20">20 - Erosion/Erosion-Corrosion</li>
      <li data-dm="22">22 - Amine SCC</li>
      <li data-dm="23">23 - Choride SCC</li>
      <li data-dm="25">25 - Hydrogen Embrittlement</li>
      <li data-dm="30">30 - Short-term Overheating‚ÄîStress Rupture</li>
      <li data-dm="31">31 - Brittle Fracture</li>
      <li data-dm="32">32 - Sigma Phase Embrittlement</li>
      <li data-dm="35">35 - Stress Relaxation Cracking</li>
      <li data-dm="45">45 - Amine Corrosion</li>
      <li data-dm="46">46 - Corrosion Under Insulation</li>
    </ul>
  </div>

  <div class="drawing">
    <div id="showDetailsMsg" onclick="openModal()">üîç Show Details</div>
    <div id="svgContainer"></div>
  </div>
</div>

<!-- ‚úÖ Modal HTML -->
<div id="popupModal">
  <div class="modal-content">
    <span class="closeBtn" onclick="closeModal()">&times;</span>
    <h2 id="modalTitle">Damage Mechanism</h2>
    <p id="modalDescription">Details will load here...</p>
  </div>
</div>

<!-- ‚úÖ Include DamageMechanism data -->
<script src="Damagemechanism.js"></script>

<script>
  let selectedDMCode = null;

  fetch("HCU-Model-Final.svg")
    .then(res => res.text())
    .then(data => {
      document.getElementById("svgContainer").innerHTML = data;

      const svgRoot = document.querySelector("#svgContainer svg");
      const dmListItems = document.querySelectorAll("#dm-list li");
      let blinkIntervals = [];

      if (!svgRoot.getAttribute("viewBox")) {
        const vb = svgRoot.getBBox();
        svgRoot.setAttribute("viewBox", `${vb.x} ${vb.y} ${vb.width} ${vb.height}`);
      }
      const viewBox = svgRoot.viewBox.baseVal;

      dmListItems.forEach(item => {
        item.addEventListener("click", () => {
          const dmCode = item.getAttribute("data-dm").trim();
          selectedDMCode = dmCode;

          document.getElementById("showDetailsMsg").style.display = "inline-block";

          blinkIntervals.forEach(interval => clearInterval(interval));
          blinkIntervals = [];

          svgRoot.querySelectorAll("text, tspan").forEach(txt => {
            txt.style.fill = "";
            txt.style.stroke = "";
            txt.style.strokeWidth = "";
            txt.style.filter = "";
          });

          let count = 0;
          svgRoot.querySelectorAll("text, tspan").forEach(txt => {
            const cleanText = txt.textContent.replace(/\s+/g, '').trim();
            if (cleanText === dmCode) {
              count++;
              let visible = true;
              const interval = setInterval(() => {
                if (visible) {
                  txt.style.fill = "red";
                  txt.style.stroke = "#00ffff";
                  txt.style.strokeWidth = "3px";
                  txt.style.filter = "drop-shadow(0 0 6px #00ffff) drop-shadow(0 0 12px red)";
                } else {
                  txt.style.fill = "#00ffff";
                  txt.style.stroke = "red";
                  txt.style.strokeWidth = "3px";
                  txt.style.filter = "drop-shadow(0 0 6px red) drop-shadow(0 0 12px #00ffff)";
                }
                visible = !visible;
              }, 500);
              blinkIntervals.push(interval);
            }
          });
        });
      });

      let isPanning = false;
      let startX, startY;

      svgRoot.addEventListener("mousedown", (e) => {
        isPanning = true;
        startX = e.clientX;
        startY = e.clientY;
        svgRoot.style.cursor = "grabbing";
      });

      window.addEventListener("mouseup", () => {
        isPanning = false;
        svgRoot.style.cursor = "grab";
      });

      window.addEventListener("mousemove", (e) => {
        if (!isPanning) return;
        const dx = (e.clientX - startX) * (viewBox.width / svgRoot.clientWidth);
        const dy = (e.clientY - startY) * (viewBox.height / svgRoot.clientHeight);
        viewBox.x -= dx;
        viewBox.y -= dy;
        startX = e.clientX;
        startY = e.clientY;
      });

      svgRoot.addEventListener("wheel", (e) => {
        e.preventDefault();
        const zoomFactor = 1.1;
        const scale = e.deltaY < 0 ? 1 / zoomFactor : zoomFactor;
        viewBox.width *= scale;
        viewBox.height *= scale;
      });
    });

  // ‚úÖ Modal functions
  function openModal() {
    if (!selectedDMCode || !DamageMechanism[selectedDMCode]) {
      alert("No details found.");
      return;
    }

    const data = DamageMechanism[selectedDMCode];
    document.getElementById("modalTitle").innerText = data.title;
    document.getElementById("modalDescription").innerText = data.description;
    document.getElementById("popupModal").style.display = "block";
  }

  function closeModal() {
    document.getElementById("popupModal").style.display = "none";
  }
</script>

  
<script>
  // DOM utility
  const createTabs = (dmData) => {
    const tabTitles = [
      "description", "affectedUnits", "mitigation",
      "inspection", "appearance", "criticalFactors", "temperatureComparison"
    ];
    
    const container = document.createElement("div");
    container.style.padding = "10px";

    const tabHeader = document.createElement("ul");
    tabHeader.style.display = "flex";
    tabHeader.style.listStyle = "none";
    tabHeader.style.margin = "0";
    tabHeader.style.padding = "0";
    tabHeader.style.borderBottom = "1px solid #ccc";

    const tabContent = document.createElement("div");
    tabContent.style.padding = "10px";

    tabTitles.forEach((key, i) => {
      if (!dmData[key]) return;

      const tab = document.createElement("li");
      tab.textContent = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
      tab.style.cursor = "pointer";
      tab.style.padding = "10px 15px";
      tab.style.border = "1px solid #ccc";
      tab.style.borderBottom = "none";
      tab.style.background = i === 0 ? "#fff" : "#eee";
      tab.addEventListener("click", () => {
        Array.from(tabHeader.children).forEach(li => li.style.background = "#eee");
        tab.style.background = "#fff";
        tabContent.innerHTML = dmData[key];
      });
      tabHeader.appendChild(tab);
      if (i === 0) tabContent.innerHTML = dmData[key];
    });

    container.appendChild(tabHeader);
    container.appendChild(tabContent);
    return container;
  };

  const showPopup = (dmId) => {
    const dmData = damageMechanisms[dmId];
    if (!dmData) {
      alert("No data available");
      return;
    }

    const popup = document.createElement("div");
    popup.style.position = "fixed";
    popup.style.top = "50%";
    popup.style.left = "50%";
    popup.style.transform = "translate(-50%, -50%)";
    popup.style.background = "#fff";
    popup.style.border = "2px solid #444";
    popup.style.boxShadow = "0 0 10px rgba(0,0,0,0.4)";
    popup.style.zIndex = "1000";
    popup.style.maxWidth = "800px";
    popup.style.maxHeight = "90vh";
    popup.style.overflowY = "auto";
    popup.style.padding = "15px";
    popup.style.borderRadius = "8px";

    const closeBtn = document.createElement("button");
    closeBtn.textContent = "Close";
    closeBtn.style.marginBottom = "10px";
    closeBtn.onclick = () => popup.remove();

    popup.appendChild(closeBtn);
    popup.appendChild(createTabs(dmData));

    document.body.appendChild(popup);
  };

  // Update list click handlers to include "Show Details" message and popup
  document.querySelectorAll("#dm-list li").forEach(item => {
    item.addEventListener("click", () => {
      const dmId = item.getAttribute("data-dm");
      let msg = item.querySelector(".show-details-msg");

      if (!msg) {
        msg = document.createElement("div");
        msg.className = "show-details-msg";
        msg.textContent = "Show Details";
        msg.style.color = "blue";
        msg.style.cursor = "pointer";
        msg.style.marginTop = "5px";
        msg.onclick = (e) => {
          e.stopPropagation();
          showPopup(dmId);
        };
        item.appendChild(msg);
      }
    });
  });
      </script>

  
</body>
</html>
